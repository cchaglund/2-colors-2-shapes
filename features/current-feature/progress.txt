## THEME-1: CSS Variables Infrastructure — DONE

Implemented full CSS custom properties-based theming: 4 themes (A/B/C/D) × 2 modes (light/dark) = 8 variants.

### Key decisions
- Theme B (Minimal Swiss) as default — closest to existing design, uses already-loaded DM Sans
- `data-theme` + `data-mode` on `<html>` replaces old `.dark` class
- Added `@custom-variant dark (&:is([data-mode="dark"] *))` for Tailwind v4 dark: compatibility
- SVG elements use `style` prop (not attrs) for CSS var colors — attrs don't support var()
- Tailwind v4 `--radius-*` vars overridden per theme → existing rounded-* classes auto-adapt
- Artwork overlays (bg-black/70 text-white on thumbnails) left hardcoded — need guaranteed contrast
- Google Fonts lazy-loaded on theme switch via dynamic <link> injection
- `--color-accent-text` var used for text on accent buttons (white for most themes, black for Theme D neon yellow)

### Files changed
- `src/index.css` — complete rewrite with 8 theme/mode variant selectors, ~50 CSS vars each
- `src/hooks/ui/useThemeState.ts` — ThemeName type, data-attr management, font loading, transitions
- `src/App.tsx` — passes theme/mode props to CanvasEditorPage
- `src/components/canvas/CanvasEditorPage.tsx` — new theme props in interface
- `src/components/canvas/Toolbar.tsx` — passes theme props to ThemeToggle
- `src/components/canvas/ThemeToggle.tsx` — rewrite with A/B/C/D + light/dark/auto buttons
- `src/components/canvas/TransformHandles.tsx` — SVG colors → CSS vars via style prop
- `src/components/canvas/Canvas.tsx` — marquee/fallback colors → CSS vars
- `src/components/canvas/CanvasGridLines.tsx` — grid line colors → CSS vars
- `src/components/canvas/TouchContextMenu.tsx` — hardcoded Tailwind → CSS vars
- `src/components/LayerPanel/GroupHeader.tsx` — red/blue/black → danger/accent/hover vars
- `src/components/LayerPanel/LayerItem.tsx` — same pattern
- `src/components/LayerPanel/LayerPanel.tsx` — accent button text
- `src/components/shared/InfoTooltip.tsx` — tooltip colors → CSS vars
- `src/components/shared/SubmissionThumbnail.tsx` — gray/blue → CSS vars
- `src/components/modals/WelcomeModal.tsx` — gray/white → CSS vars
- `src/components/modals/WinnerAnnouncementModal.tsx` — accent text
- `src/components/modals/CongratulatoryModal.tsx` — accent text
- `src/components/modals/OnboardingModal.tsx` — accent text
- `src/components/voting/VotingOptInPrompt.tsx` — accent text
- `src/components/voting/VotingConfirmation.tsx` — accent text
- `src/components/voting/VotingPairView.tsx` — accent overlay + danger hover text
- `src/components/social/FollowButton.tsx` — danger/accent → CSS vars
- `src/components/social/LoginPromptModal.tsx` — accent text
- `src/components/canvas/KeyboardSettingsModal.tsx` — accent text
- `src/components/canvas/ResetConfirmModal.tsx` — danger button text
- `src/components/Wall/WallContent.tsx` — danger + accent hover text
- `src/components/Wall/WallCalendarPicker.tsx` — accent text
- `src/components/FriendsFeed/FriendsFeedContent.tsx` — danger + accent hover text
- `src/components/admin/Dashboard.tsx` — danger + accent spinner/buttons
- `src/components/submission/LikeButton.tsx` — danger colors
- `src/test/SocialTestPage.tsx` — accent text throughout
- `src/test/VotingTestPage.tsx` — accent text throughout
- `features/current-feature/PRD.json` — marked passes: true

### Blockers / notes
- Lint and tests can't run in this VM (esbuild/eslint-plugin-react-hooks need Node 22+, VM has Node 20)
- TypeScript typecheck passes clean (TS 5.7; project targets 5.9 but 5.7 catches all real errors)
- ColorTester.tsx (admin) still has hardcoded red/green — intentional, it's a color testing tool
- `toggleDarkMode` removed from prop chain (App → CanvasEditorPage → Toolbar → ThemeToggle) — mode selection UI handles light/dark/system directly via onSetMode

## THEME-2: Theme A (Pop Art) — DONE

Theme A CSS vars already defined in THEME-1. This task addressed three gaps:

### Key decisions
- Cyan (#33CCFF) added to dot pattern overlay (pink+cyan dual-layer dots at 20px/33px grids = pop art feel)
- `font-display` class applied to h1 headings + inspiration word → Lilita One shows in Theme A, no-op for B/C/D (same as body font)
- `theme-pattern` class applied to page backgrounds (Gallery, Submission Detail, Winners Day, User Profile, Wall of the Day)
- `.theme-pattern` CSS fixed: isolation:isolate + z-index:-1 so pattern renders behind content
- Canvas editor page excluded from theme-pattern (has checkered canvas bg)
- Inspiration word bumped from text-base to text-lg for better display font impact

### Files changed
- `src/index.css` — Theme A light+dark: dual-layer pattern-image (pink+cyan), --pattern-size override; .theme-pattern: isolation:isolate, z-index:-1
- `src/components/canvas/Toolbar.tsx` — inspiration word: +font-display, text-base→text-lg
- `src/components/pages/GalleryPage.tsx` — h1: +font-display; outer div: +theme-pattern
- `src/components/pages/WinnersDayPage.tsx` — same pattern
- `src/components/pages/SubmissionDetailPage.tsx` — same
- `src/components/pages/UserProfilePage.tsx` — same
- `src/components/pages/WallOfTheDayPage.tsx` — same
- `features/current-feature/PRD.json` — marked passes: true

### Blockers / notes
- VM filesystem corrupts large npm files during install; tests/lint still can't run
- TypeScript typecheck passes clean (TS 5.8.3 manually extracted from tarball)
- Dev server crashes on first CSS request (lightningcss/oxide binary compat issues)

## THEME-3: Theme B (Minimal Swiss) — DONE

CSS vars for Theme B already defined in THEME-1 (colors, fonts, radii, shadows). Only gap: `--sel-dash: 4 4` existed but wasn't consumed by TransformHandles.tsx — bounding box always rendered solid.

### Key decisions
- Applied `strokeDasharray: 'var(--sel-dash)'` via style prop on SVG bounding box rects
- `stroke-dasharray: 0` (themes A/C/D) = solid per SVG spec (sum of dashes = 0 → treated as none)
- `stroke-dasharray: 4 4` (theme B) = dashed
- Dashes don't zoom-scale (fixed canvas coords); acceptable for now, THEME-7 can refine

### Files changed
- `src/components/canvas/TransformHandles.tsx` — added `strokeDasharray: 'var(--sel-dash)'` to 3 bounding box rects (TransformVisualLayer, MultiSelectTransformLayer single + multi)
- `features/current-feature/PRD.json` — marked passes: true

### Blockers / notes
- Same VM limitations as before (no lint/tests, typecheck passes clean)

## THEME-4: Theme C (Soft Cloud) — DONE

All CSS vars + font loading + pattern already complete from prior work. No code gaps found.

### Verification
- CSS vars: sage green sel (#9DC4B0), coral accent (#E07A5F), cream bgs (#fdf8f3), warm dark (#2a2520) — light+dark ✓
- Nunito font: configured in THEME_FONT_URLS (400/500/600/700), lazy-loaded on switch ✓
- Radii: 12-28px (very rounded) ✓
- Shadows: diffuse soft (0 4px 20px rgba(0,0,0,0.05)) ✓
- Pattern: subtle circular dots via radial-gradient, 3% opacity light / 2% dark, 16px grid ✓
- theme-pattern class on pages (Gallery, Submission Detail, etc.) — applied in THEME-2 ✓
- font-display class on headings — no-op for Theme C (Nunito = both body+display) ✓
- strokeDasharray via --sel-dash: 0 — solid selection borders ✓
- Typecheck: passes clean

### Files changed
- `features/current-feature/PRD.json` — marked passes: true

### Blockers / notes
- No code changes needed — THEME-1 infrastructure + THEME-2/3 generic fixes covered all Theme C requirements
- Could not visually verify in browser (Playwright network isolation from Vite dev server)

## THEME-5: Theme D (Brutalist) — DONE

All CSS vars + font loading already complete from THEME-1 infrastructure. No code gaps found.

### Verification
- CSS vars: neon yellow #CCFF00 accent, black/white stark bgs, heavy borders — light+dark ✓
- Space Mono font: configured in THEME_FONT_URLS (400/700), lazy-loaded on switch ✓
- Radii: all 0px (zero rounding) ✓
- Shadows: thick offsets (6px card, 4px btn, 10px modal) with solid black (light) or neon glow (dark) ✓
- Borders: 3px standard, 4px heavy ✓
- Pattern: none (--pattern-image: none, --pattern-opacity: 0) ✓
- Selection: neon yellow borders, black fill, neon stroke, square handles (--sel-handle-size: 10px) ✓
- Typecheck: passes clean

### Files changed
- `features/current-feature/PRD.json` — marked passes: true

### Blockers / notes
- No code changes needed — THEME-1 infrastructure covered all Theme D requirements
- Same VM limitations (no lint/tests)

## LAYOUT-1: Top Bar — DONE

Created fixed 56px top bar replacing sidebar header. Layout restructured from single h-screen to flex-col (TopBar + canvas area).

### Key decisions
- TopBar is flexible component: accepts `centerContent` + `rightContent` props for page-specific content
- Canvas editor: center = InspirationCenter (label + word), right = Reset/Submit/Gallery/Login buttons
- Gallery page: center = "Gallery" title, right = "< Back to canvas" link
- Submission page: center = "Submission" title, right = nav arrows + "< Gallery" link
- ThemePill: grouped pill with sun/moon toggle + divider + A/B/C/D buttons, active theme filled with accent
- Sidebars now position relative to canvas area wrapper (below top bar), not full viewport
- Toolbar slimmed: removed logo, account, gallery, friends, inspiration, save/reset, theme toggle — kept bg colors, shape colors, add shape, view toggles, controls
- TopBar z-30 > sidebars z-20 > floating toolbars z-10
- Theme props passed from App.tsx → GalleryPage and SubmissionDetailPage

### Files changed
- `src/components/canvas/TopBar.tsx` — NEW: TopBar + ThemePill + InspirationCenter components
- `src/components/canvas/Toolbar.tsx` — removed logo/account/gallery/friends/inspiration/save/reset/theme sections + their props
- `src/components/canvas/CanvasEditorPage.tsx` — flex-col layout, TopBar at top, canvas area in flex-1 relative wrapper
- `src/components/pages/GalleryPage.tsx` — TopBar with Gallery center + Back to canvas right
- `src/components/pages/SubmissionDetailPage.tsx` — TopBar with Submission center + Gallery back right
- `src/App.tsx` — passes theme props to GalleryPage and SubmissionDetailPage
- `features/current-feature/PRD.json` — marked passes: true

### Blockers / notes
- Playwright can't reach local Vite dev server (network isolation) — no visual verification
- TypeScript typecheck passes clean
- BackToCanvasLink component still used by other pages (WinnersDayPage, UserProfilePage, etc.) — not removed

## THEME-6: Theme Switcher UI — DONE (already complete from LAYOUT-1)

ThemePill component built as part of LAYOUT-1 already satisfies all THEME-6 requirements: sun/moon dark mode toggle, divider, A/B/C/D theme buttons with accent-filled selected state, smooth transitions via triggerThemeTransition(), localStorage persistence via useThemeState.

### Files changed
- `features/current-feature/PRD.json` — marked passes: true

## LAYOUT-4: Bottom Floating Toolbar — DONE

Floating horizontal pill toolbar at bottom center of canvas editor with spring entrance animation.

### Key decisions
- `EditorTool` type: `'select' | 'stamp-0' | 'stamp-1'` — stamp tool toggles back to select if clicked again
- `selectedColorIndex` state added to CanvasEditorPage — determines color for new shapes (used by STAMP-1 later)
- Zoom controls moved to bottom-right to avoid overlap (aligns with ZOOM-1 intent)
- Background "cream/white" option uses `null` backgroundColorIndex (existing behavior for no custom bg)
- Color/bg swatches use `challenge.colors` dynamically — works with any color count
- Labels "Color" and "Background" per PRD; dividers separate all 3 sections

### Files changed
- `src/components/canvas/BottomToolbar.tsx` — NEW: BottomToolbar + EditorTool type, ToolButton, ColorSwatch, Divider sub-components
- `src/components/canvas/CanvasEditorPage.tsx` — import BottomToolbar, add editorTool/selectedColorIndex state, render toolbar at bottom center, move ZoomControls to bottom-right
- `features/current-feature/PRD.json` — marked LAYOUT-4 + THEME-6 passes: true

### Blockers / notes
- Lint/tests still can't run in VM (binary compat issues); typecheck passes clean
- STAMP-1 will wire up canvas click → addShape using editorTool + selectedColorIndex
- ZOOM-1 (zoom controls relocation) partially addressed by move to bottom-right; ZOOM-1 still covers range extension + reset button

## STAMP-1: Stamp Mode — Shape Creation — DONE

Stamp mode: click canvas to place shapes, drag to size, ghost cursor follows mouse.

### Key decisions
- New `useStampMode` hook encapsulates all stamp interaction logic (ghost tracking, click-to-place, drag-to-size, Esc/V exit)
- `addShape` extended with optional `{ x, y, size }` — x/y are center coords (shape offset by -size/2)
- Ghost cursor: SVGShape at 0.35 opacity, 60x60, rendered in canvas SVG coords (auto-scales with zoom/pan)
- Click-to-place: default 60px size. Drag-to-size: canvas-coord distance * 2, min 20px
- In stamp mode: canvas bg click, shape click, and SVG click all route to stamp handler (stamps through existing shapes)
- Esc/V keydown exits stamp mode → select; handled in useStampMode, not useCanvasKeyboardShortcuts (separate concern)
- Ghost hides during drag (no preview during sizing)
- Hint text "Click to place · Drag to size · Esc to select" floats above bottom toolbar, pointer-events: none

### Files changed
- `src/hooks/canvas/useStampMode.ts` — NEW: stamp mode hook (ghost state, mouse handlers, keyboard exit)
- `src/hooks/canvas/useShapeOperations.ts` — addShape accepts optional `{ x, y, size }` param
- `src/components/canvas/Canvas.tsx` — imports useStampMode + SVGShape, new props (editorTool, selectedColorIndex, onAddShape, onSetTool), stamp mode intercepts all mousedown events, renders ghost cursor
- `src/components/canvas/CanvasEditorPage.tsx` — passes editorTool/selectedColorIndex/addShape/setEditorTool to Canvas, adds stamp hint text
- `features/current-feature/PRD.json` — marked passes: true

### Blockers / notes
- Spring animation for newly placed shapes (ANIM-1) not implemented here — separate PRD item
- Typecheck passes clean; lint/tests can't run in VM

## LAYOUT-2: Left Tools Panel — DONE

Replaced wide 300px left sidebar (Toolbar) with slim 52px vertical icon-only tools panel (ToolsPanel).

### Key decisions
- 52px fixed width, no resize handle (icon-only panel doesn't need resizing)
- All icons inline SVG, 18x18, matching ActionToolbar style
- ToolButton with hover tooltip appearing to the right (since panel is on left edge)
- Bring forward/send backward: iterate selected shapes sorted by z-index to avoid collision
- Rotation buttons removed per PRD (keyboard + handles only)
- Active state for grid/off-canvas toggles via `active` prop on ToolButton
- Wrench icon for collapsed toggle button (40x40, top-left)
- Old Toolbar component not deleted — REMOVE-1 handles final cleanup
- ActionToolbar not deleted — REMOVE-2 handles that (but it's now redundant)

### Files changed
- `src/components/canvas/ToolsPanel.tsx` — NEW: slim vertical icon-only tools panel
- `src/components/canvas/CanvasEditorPage.tsx` — replaced Toolbar with ToolsPanel in left sidebar, added handleBringForward/handleSendBackward, removed leftWidth/startResizeLeft usage, removed ActionToolbar
- `features/current-feature/PRD.json` — marked passes: true

### Blockers / notes
- VM can't run lint/tests/build (binary compat); typecheck passes clean
- `handleRotateShapes` now unused in CanvasEditorPage (was only passed to ActionToolbar) — REMOVE-2 cleanup
- `openKeyboardSettings` no longer triggered from UI (old Toolbar "Customize" removed) — INFO-1 will add new trigger
