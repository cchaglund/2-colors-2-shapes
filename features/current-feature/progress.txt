## REFACTOR-001 — Create shared <SVGShape> component
- Created src/components/SVGShape.tsx
- Props: type, size, x, y, rotation, flipX, flipY, color, style (optional)
- Handles all 4 SVG element types: ellipse, rect, polygon, path
- Transform logic identical to ShapeElement/SubmissionThumbnail/SubmissionCanvas
- Typecheck: pass. Tests: 102 pass. Lint: clean (pre-existing error in useCalendarChallenges.ts unrelated).
- Note: npm install requires sandbox workaround (see installing-packages.md)
- Next: REFACTOR-002/003/004 to replace inline rendering with <SVGShape> in consumers

## REFACTOR-002 — Refactor ShapeElement.tsx to use SVGShape
- Added `dataShapeId` prop to SVGShape for DOM identification (data-shape-id attribute)
- ShapeElement now delegates entirely to SVGShape, passing shape props + cursor style + dataShapeId
- Removed getShapeSVGData import and all inline transform/render logic from ShapeElement
- ShapeElement reduced from 41 to 28 lines
- Files changed: src/components/SVGShape.tsx, src/components/ShapeElement.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-003/004 for SubmissionThumbnail/SubmissionCanvas

## REFACTOR-003 — Refactor SubmissionThumbnail.tsx to use SVGShape
- Replaced inline getShapeSVGData + transform + conditional element rendering with <SVGShape>
- Removed getShapeSVGData import, replaced with SVGShape import
- Shape rendering block reduced from 17 lines to 12 lines
- Files changed: src/components/SubmissionThumbnail.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-004 for SubmissionCanvas

## REFACTOR-004 — Refactor SubmissionCanvas.tsx to use SVGShape
- Replaced getShapeSVGData import + inline transform/conditional rendering with SVGShape
- Shape map block reduced from 17 lines to 12 lines
- Files changed: src/components/submission/SubmissionCanvas.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-005 (ShapeIcon) or REFACTOR-008 (RANK_COLORS) — phase 1 remaining items

## REFACTOR-005 — Create shared ShapeIcon component
- Created src/components/ShapeIcon.tsx
- Props: type (ShapeType), size (optional, default 24)
- Uses getShapeSVGData() viewBox dimensions for correct aspect ratios
- Renders with fill="currentColor" for inheriting parent text color
- Files changed: src/components/ShapeIcon.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-006/007 to replace local icons in Toolbar/WelcomeModal

## REFACTOR-006 — Refactor Toolbar.tsx to use shared ShapeIcon
- Removed local ShapePreviewIcon function (lines 14-24)
- Replaced with import of shared ShapeIcon from ./ShapeIcon
- Removed unused getShapeSVGData and ShapeType imports
- Files changed: src/components/Toolbar.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-007 (WelcomeModal ShapeIcon) or REFACTOR-008 (RANK_COLORS)

## REFACTOR-007 — Refactor WelcomeModal.tsx to use shared ShapeIcon
- Removed local ShapeIcon function (lines 10-20), replaced with import of shared ShapeIcon
- Removed unused getShapeSVGData import
- Local version had loose `type: string` typing with `as never` cast; shared version uses proper ShapeType
- Files changed: src/components/modals/WelcomeModal.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-008 (RANK_COLORS constant) then REFACTOR-009/010/011 consumers

## REFACTOR-008 — Create RANK_COLORS constant
- Created src/constants/rankColors.ts exporting RANK_COLORS: Record<1|2|3, string>
- Gold=#FFD700, Silver=#D1D5DC, Bronze=#CE8946
- Files changed: src/constants/rankColors.ts
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-009/010/011 to replace hardcoded hex values in TrophyBadge/WinnerCard/CalendarCell

## REFACTOR-009 — Refactor TrophyBadge.tsx to use RANK_COLORS
- Replaced ternary chain `rank === 1 ? "#FFD700" : rank === 2 ? "#D1D5DC" : "#CE8946"` with `RANK_COLORS[rank]`
- Added import of RANK_COLORS from constants
- Files changed: src/components/TrophyBadge.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-010 (WinnerCard) and REFACTOR-011 (CalendarCell)

## REFACTOR-010 — Refactor WinnerCard.tsx to use RANK_COLORS
- Replaced ternary chain of Tailwind `bg-[#hex]` classes with `RANK_COLORS[rank]` lookup
- Switched from Tailwind arbitrary value class to inline `style={{ backgroundColor }}` — dynamic interpolation breaks Tailwind JIT scanning
- Removed `getBorderStyle()` helper, inlined the static Tailwind classes directly
- Files changed: src/components/WinnerCard.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-011 (CalendarCell) and REFACTOR-012 (CANVAS_SIZE)

## REFACTOR-011 — Refactor CalendarCell.tsx to use RANK_COLORS
- Removed local `rankOutlineColors` duplicate map, replaced with import of shared RANK_COLORS
- Updated `borderStyle` computation to use `RANK_COLORS[rankOutline]`
- Files changed: src/components/Calendar/CalendarCell.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-012 (CANVAS_SIZE constant) — last Phase 1 item

## REFACTOR-012 — Deduplicate CANVAS_SIZE constant
- CANVAS_SIZE=800 already exported from src/types/canvas.ts; removed 4 local duplicates
- Replaced local `const CANVAS_SIZE = 800` with import in: SubmissionCanvas.tsx, SubmissionThumbnail.tsx, useExportActions.ts, useBackgroundPanning.ts
- PRD said "two files" but found 4 duplicates total (SubmissionCanvas, SubmissionThumbnail, useExportActions, useBackgroundPanning)
- Files changed: src/components/submission/SubmissionCanvas.tsx, src/components/SubmissionThumbnail.tsx, src/hooks/useExportActions.ts, src/hooks/useBackgroundPanning.ts
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Phase 1 complete. Next: Phase 2 (REFACTOR-013, shared Modal wrapper)

## REFACTOR-013 — Create shared Modal wrapper component
- Created src/components/Modal.tsx
- Props: onClose, children, size (max-w class), className, closeOnEscape (default true), closeOnBackdropClick (default true), ariaLabelledBy, zIndex
- Backdrop: fixed inset-0, bg-(--color-modal-overlay), flex center, configurable z-index
- Content box: bg-(--color-bg-primary), border, rounded-lg, p-6, configurable max-w via size prop
- Escape key closes modal when closeOnEscape=true
- Backdrop click closes modal when closeOnBackdropClick=true (e.target === e.currentTarget check)
- Focus trap: Tab/Shift+Tab cycles through focusable elements within modal
- Auto-focuses first focusable element on mount
- Accessibility: role="dialog", aria-modal="true", configurable aria-labelledby
- Files changed: src/components/Modal.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-014 through REFACTOR-022 (refactor each modal to use shared Modal)

## REFACTOR-014 — Refactor OnboardingModal to use shared Modal
- Replaced inline `fixed inset-0 bg-black/50` backdrop + content box with shared `<Modal>`
- OnboardingModal is non-closable (onboarding must be completed): closeOnEscape=false, closeOnBackdropClick=false, onClose=no-op
- Used size="max-w-sm" to match original max-w-sm styling
- Added aria-labelledby="onboarding-title" with matching id on h2
- Files changed: src/components/modals/OnboardingModal.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-015 (WelcomeModal)

## REFACTOR-015 — Refactor WelcomeModal to use shared Modal
- Replaced inline backdrop div (`fixed inset-0 bg-black/50`) + content box with shared `<Modal>`
- Removed manual escape key handler, focus trap, modalRef, buttonRef — all handled by shared Modal
- Removed `useEffect` and `useRef` imports (no longer needed)
- WelcomeModal reduced from 155 to 99 lines
- Files changed: src/components/modals/WelcomeModal.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-016 (FriendsModal)

## REFACTOR-016 — Refactor FriendsModal to use shared Modal
- Replaced both render paths (not-logged-in + logged-in) with shared `<Modal>`
- Removed manual escape handler, focus trap, modalRef, handleOverlayClick — all handled by Modal
- Logged-in path uses `className="!p-0 max-h-[80vh] flex flex-col"` to override default padding and add scroll layout
- Not-logged-in path uses default Modal padding (p-6)
- Removed `useEffect`, `useRef`, `useCallback` (handleOverlayClick) imports — only `useCallback` kept for handleNavigateToProfile
- FriendsModal reduced from 161 to 109 lines
- Files changed: src/components/modals/FriendsModal.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-017 (KeyboardSettingsModal)

## REFACTOR-017 — Refactor KeyboardSettingsModal to use shared Modal
- Replaced outer backdrop div (`fixed inset-0 bg-(--color-modal-overlay)`) + content box with shared `<Modal>`
- Used `className="!p-0 max-h-[80vh] overflow-hidden flex flex-col"` to preserve custom header/content/footer layout
- Set `closeOnEscape={false}` — component has custom 3-level escape logic (cancel listening > dismiss conflicts > close)
- Conflict resolution dialog also uses shared `<Modal>` with `zIndex="z-60"`, `closeOnEscape={false}`, `closeOnBackdropClick={false}`
- Removed `useRef` import (Modal handles its own ref)
- Files changed: src/components/KeyboardSettingsModal.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-018 (ResetConfirmModal)

## REFACTOR-018 — Refactor ResetConfirmModal to use shared Modal
- Replaced inline `fixed inset-0` backdrop + content box with shared `<Modal>`
- Destructive confirmation: `closeOnEscape={false}`, `closeOnBackdropClick={false}`
- Preserved `z-1000` via zIndex prop, `max-w-100` via size prop, `text-center` via className
- Added `ariaLabelledBy="reset-confirm-title"` with matching id on h3
- Files changed: src/components/ResetConfirmModal.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-019 (VotingModal)

## REFACTOR-019 — Refactor VotingModal to use shared Modal
- Replaced inline `fixed inset-0 bg-black/50` backdrop + `ref={modalRef}` wrapper with shared `<Modal>`
- Modal content box styled as transparent (`!p-0 !border-0 !bg-transparent !rounded-none`) — child components (VotingPairView, VotingConfirmation, etc.) own their own card styling
- Context-dependent close: `handleClose` switches between `onComplete` (confirmation/opt-in screens) and `onSkipVoting` (voting screen) — passed as `onClose` to Modal
- Removed manual focus trap and escape key handler (30+ lines) — delegated to shared Modal
- Removed `useRef` import (no longer needed)
- Files changed: src/components/voting/VotingModal.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-020 (CongratulatoryModal)

## REFACTOR-020 — Refactor CongratulatoryModal to use shared Modal
- Replaced both render paths (loading + main) with shared `<Modal>`
- Loading state: `closeOnBackdropClick={false}` (no accidental dismiss while loading)
- Main state: default close behavior (escape + backdrop click), `ariaLabelledBy="congrats-title"`
- Removed `modalRef`, `buttonRef`, manual escape handler, focus trap (~30 lines) — delegated to shared Modal
- Confetti logic unchanged (useRef + useEffect for canvas-confetti)
- File reduced from 169 to 119 lines
- Files changed: src/components/modals/CongratulatoryModal.tsx
- Typecheck: pass. Tests: 102 pass. Lint: pre-existing error only.
- Next: REFACTOR-021 (WinnerAnnouncementModal)
